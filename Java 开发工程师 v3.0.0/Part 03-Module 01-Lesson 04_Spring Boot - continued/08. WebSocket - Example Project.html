<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>WebSocket - Example Project</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>Spring Boot - continued</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Spring Boot Exception Handling.html">01. Spring Boot Exception Handling</a>
    </li>
    <li class="">
      <a href="02. Spring Boot Exception - Custom Error Page.html">02. Spring Boot Exception - Custom Error Page</a>
    </li>
    <li class="">
      <a href="03. Spring Boot Exception - Exception Handlers.html">03. Spring Boot Exception - Exception Handlers</a>
    </li>
    <li class="">
      <a href="04. Spring Boot Exception- @ControllerAdvise + @ExceptionHandler.html">04. Spring Boot Exception- @ControllerAdvise + @ExceptionHandler</a>
    </li>
    <li class="">
      <a href="05. Spring Boot Exception - SimpleMappingExceptionResolver.html">05. Spring Boot Exception - SimpleMappingExceptionResolver</a>
    </li>
    <li class="">
      <a href="06. Spring Boot Exception Handling - Summary.html">06. Spring Boot Exception Handling - Summary</a>
    </li>
    <li class="">
      <a href="07. WebSocket and STOMP.html">07. WebSocket and STOMP</a>
    </li>
    <li class="">
      <a href="08. WebSocket - Example Project.html">08. WebSocket - Example Project</a>
    </li>
    <li class="">
      <a href="09. Package Spring Boot Application.html">09. Package Spring Boot Application</a>
    </li>
    <li class="">
      <a href="10. Course Recap.html">10. Course Recap</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">08. WebSocket - Example Project</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---example-project">WebSocket - Example Project</h2>
<p>In this lesson, we'll build an example project that implements WebSocket. Follow the instructions in each section to create the related project components</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---project-setup">WebSocket - Project Setup</h2>
<p>To create and setup your project, follow the instructions below: </p>
<ol>
<li><p>Go to <a href="https://start.spring.io/" rel="noopener noreferrer" target="_blank">https://start.spring.io/</a> and name the artifact "spring-boot-websocket" </p></li>
<li><p>Add the following dependencies to your project: Spring Web, WebSocket, Thymeleaf, and Spring Boot DevTool</p></li>
<li><p>Download the project, unzip it, and import it to IntelliJ</p></li>
</ol>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---model-implementation">WebSocket - Model Implementation</h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A12 WEBSOCKET</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A12 WEBSOCKET-tNHP_Z4OOV4.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A12 WEBSOCKET-tNHP_Z4OOV4.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A13 WEBSOCKET MESSAGE DEMO</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A13 WEBSOCKET MESSAGE DEMO-gAXppfO_ljs.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A13 WEBSOCKET MESSAGE DEMO-gAXppfO_ljs.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>A message is the payload a client wants to send to a server. So, we need to represent it by a class at the server side, in this example, we defined a class to represent our message and we called it "User" which contains one attribute which is "name" and it represents the name of the sender. We also defined a message wrapper class to wrap our message with it (we called it "UserResponse" in this example), it contains one attribute which is "content". </p>
<p>The wrapper class is not a mandatory step when building WebSocket applications, in some cases it's enough to have a class that represents the payload only (in this example, we called it "User", of course when you build your application you can use different names). We only used the wrapper class because we needed the message in this example to say "Hello <em>name</em>", where "name" is coming from the User object. By that, we'll receive an object of User at the server side, then at the controller, we'll wrap it with a UserResponse object, where we assign the value of "Hello <em>name</em>" to the "content" attribute to build the full message text, this will allow the controller to use the UserResponse object when it wants to send the message to different end points instead of using the User object. Again, in this example we needed to use a wrapper class to wrap the User info with it and create our full message which says "Hello <em>name</em>". If you build an application that doesn't have such needs and it needs to send the received message as is, then you don't need to use a wrapper class. </p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---message-handling-controller-implementation">WebSocket - Message Handling Controller Implementation</h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A14 WEBSOCKET CONTROLLER</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A14 WEBSOCKET CONTROLLER-xxeMizdCgqE.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A14 WEBSOCKET CONTROLLER-xxeMizdCgqE.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A15 WEBSOCKET CONTROLLER DEMO</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A15 WEBSOCKET CONTROLLER DEMO-fG8Tpdj2gew.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A15 WEBSOCKET CONTROLLER DEMO-fG8Tpdj2gew.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p><code>@MessageMapping</code> annotation is used to indicate that any client request URL that ends with "/user" should be handled by <code>getUser</code> method in the controller. </p>
<p><code>@SendTo</code> annotation is used to define to which broker the return value of the method will be sent, in this case it'll be sent to the broker at the end point "/topic/user" which will broadcast it to all clients  that are subscribed to the end point "topic/user".</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---configuration">WebSocket - Configuration</h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>Now we need to enable the WebSocket and STOMP messaging in Spring Boot. To do that, we need to create a configuration class. Follow the instructions below to create it: </p>
<ol>
<li>Create a "config" directory under your application directory</li>
<li>Create a class and name it "WebSocketConfig" and make it implements <code>WebSocketMessageBrokerConfigurer</code> </li>
<li>Add the annotations <code>@EnableWebSocketMessageBroker</code> and <code>@Configuration</code> to the class.</li>
<li>Your code should look like the one below:  </li>
</ol>
<pre><code>@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void registerStompEndpoints(StompEndpointRegistry stompEndpointRegistry) {
        stompEndpointRegistry.addEndpoint("/websocket-demo").withSockJS();
    }

    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        registry.enableSimpleBroker("/topic");
        registry.setApplicationDestinationPrefixes("/app");
    }

}</code></pre>
<p>In the code above <code>@configuration</code> annotation is used to indicate that this is a configuration class. <code>@EnableWebSocketMessageBroker</code> annotation enables handling messages through WebSocket combined with a message broker. In <code>registerStompEndpoints</code> method, we registered a WebSocket endpoint through which a client can communicate with our server. Using <code>withSockJS</code> means that if WebSocket is not supported by the client's browser, the browser will use SockJS which is a Javascript library for browsers that offers objects similar to WebSocket objects. </p>
<p>In <code>configureMessageBroker</code> method, we configured a message broker. The broker performs messages routing from one client to another. The first line in this method enables a message broker at the endpoint "/topic", i.e., any client message that has a destination URL that starts with (prefixed with) "/topic" should be routed to that broker at that endpoint. The second line, indicates that any client message that has a destination URL that starts with "/app" should be routed to a handler method in the controller class. In our example, you can see that in our controller class we have a handler method that has a message mapping value equal to "/user" where any client message that has a destination URL that ends with "/user" will be routed to it. So, for example, if a URL ends with "/app/user" it means two things, 1) since the destination starts with app, this message should be handled by some method in the controller class. 2) since the destination URL ends with "/user", it means <code>getUser</code> method in the controller class will handle it.  </p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A16 WEBSOCKET CONFIG</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A16 WEBSOCKET CONFIG-F-On61H0Irg.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A16 WEBSOCKET CONFIG-F-On61H0Irg.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A17 WEBSOCKET CONFIG DEMO</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A17 WEBSOCKET CONFIG DEMO-klKJkneUJn4.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A17 WEBSOCKET CONFIG DEMO-klKJkneUJn4.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="websocket---scheduler-implementation">WebSocket - Scheduler Implementation</h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A18 WEBSOCKET SCHEDULER</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A18 WEBSOCKET SCHEDULER-v-vxQiAmz0g.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A18 WEBSOCKET SCHEDULER-v-vxQiAmz0g.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>In <code>sendAdhocMessage</code> method, we use SimpleMessagingTemplate object to send a message to the destination "/topic/user", our message is "Scheduler" where we represent it using a UserResponse object. </p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h1 id="websocket---creating-view">WebSocket - Creating View</h1>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A19 WEBSOCKET VIEW</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A19 WEBSOCKET VIEW-7u9VPX6TDfQ.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A19 WEBSOCKET VIEW-7u9VPX6TDfQ.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>To create the view of this example, you need the following: </p>
<ol>
<li><p>You need to create a simple UI with a message input, and a button. Users can enter a message and send it.</p></li>
<li><p>You need to create two buttons to manage WebSocket connection. One is to connect, one is to disconnect.</p></li>
<li><p>You need to add javascript to send messages and receive messages from the server-side. You basically need to import sockjs and stomp javascript libraries to communicate with the server using STOMP. There are few functions needed to be implemented.</p>
<ul>
<li>connect() -&gt; to establish the connection to the endpoint. And making the stompClient subscribe to the prefix.</li>
<li>disconnect() -&gt; disconnect from endpoint</li>
<li>sendMessage() -&gt; send message with stompClient.send when clicked.</li></ul></li>
</ol>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A20 VIEW EXPLAIN</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A20 VIEW EXPLAIN-J7v34DJTfYE.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A20 VIEW EXPLAIN-J7v34DJTfYE.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A21 WEBSOCKET DEMO</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A21 WEBSOCKET DEMO-eC_s9jiGeZU.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A21 WEBSOCKET DEMO-eC_s9jiGeZU.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h1 id="websocket---summary">WebSocket - Summary</h1>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>035ND C01 L04 A22 WEBSOCKET IMPLEMENTATION SUMMARY</p></h3>
  <video controls>
  <source src="08. 035ND C01 L04 A22 WEBSOCKET IMPLEMENTATION SUMMARY-LoJlpMwIAfo.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="08. 035ND C01 L04 A22 WEBSOCKET IMPLEMENTATION SUMMARY-LoJlpMwIAfo.en.vtt" label="en">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>Some of you might find this implementation extremely difficulty and some of you may get stuck because you are not familiar with Javascript or did not get the whole idea of WebSocket. Don’t worry about it. Please feel free to checkout the complete solution and compare each class or file with the implementation step. </p>
<p>Luckily, all WebSocket implementations look familiar, so once you figured out how to implement one application, you should have no problem implementing one yourself in future. </p>
<p>**Solution: <a href="https://github.com/udacity/nd035-v1-C1-Java-Basics-Exercises-and-Project-Starter/tree/master/demos/spring-boot-websocket**" rel="noopener noreferrer" target="_blank">https://github.com/udacity/nd035-v1-C1-Java-Basics-Exercises-and-Project-Starter/tree/master/demos/spring-boot-websocket**</a></p>
<p><strong>Note: In the solution repository above, the message and message wrapper classes are named Message and Greeting, respectively, instead of User and UserResponse in the example we explained. The concept is the same, only the classes names are different.</strong></p>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="09. Package Spring Boot Application.html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('08. WebSocket - Example Project')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
