<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Deployment - III</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>CI/CD</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Introduction.html">01. Introduction</a>
    </li>
    <li class="">
      <a href="02. CICD.html">02. CI/CD</a>
    </li>
    <li class="">
      <a href="03. Git.html">03. Git</a>
    </li>
    <li class="">
      <a href="04. AWS.html">04. AWS</a>
    </li>
    <li class="">
      <a href="05. EC2 - Launch an Instance.html">05. EC2 - Launch an Instance</a>
    </li>
    <li class="">
      <a href="06. EC2 Dashboard.html">06. EC2 Dashboard</a>
    </li>
    <li class="">
      <a href="07. EC2 - Connect to Linux Instance.html">07. EC2 - Connect to Linux Instance</a>
    </li>
    <li class="">
      <a href="08. Monitor your AWS Costs and Credits.html">08. Monitor your AWS Costs and Credits</a>
    </li>
    <li class="">
      <a href="09. Docker.html">09. Docker</a>
    </li>
    <li class="">
      <a href="10. Docker - II.html">10. Docker - II</a>
    </li>
    <li class="">
      <a href="11. Jenkins.html">11. Jenkins</a>
    </li>
    <li class="">
      <a href="12. Bringing it all Together.html">12. Bringing it all Together</a>
    </li>
    <li class="">
      <a href="13. Deployment - I.html">13. Deployment - I</a>
    </li>
    <li class="">
      <a href="14. Deployment - II.html">14. Deployment - II</a>
    </li>
    <li class="">
      <a href="15. Deployment - III.html">15. Deployment - III</a>
    </li>
    <li class="">
      <a href="16. Another Deployment.html">16. Another Deployment</a>
    </li>
    <li class="">
      <a href="17. Conclusion.html">17. Conclusion</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">15. Deployment - III</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="jenkins--add-plugins--configure-tools">Jenkins | Add Plugins | Configure Tools</h2>
<p>In this step, we will configure the Jenkins console to connect the other end of <em>pipeline</em> to Tomcat container. You can visualize that the first end of the <em>pipeline</em> is already connected with your Github repository. </p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>ND035 C4 Security And DevOps Deploy 01c (Online-Video-Cutter.Com) (1)</p></h3>
  <video controls>
  <source src="15. ND035 C4 Security And DevOps Deploy 01c (Online-Video-Cutter.Com) (1)-MmR4Rm1_lIo.mp4" type="video/mp4">

</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ol>
<li><strong>Add Plugins</strong><br><br />
On the Jenkins console, go to the Manage Jenkins &#8594; Manage Plugins section. Here you can add new ones, or update the existing plugins. For our deployment, we need to add the following two plugins:</li>
</ol>
<ul>
<li><p><strong>Deploy to container plugin</strong>: This plugin takes a war/ear file and deploys that to a running remote application server at the end of a build. </p></li>
<li><p><strong>Maven Integration plugin</strong>: This plugin is used for building Maven jobs. </p>
<p>The snapshots below show that we have already installed them on our Jenkins. In your case, search with name on the <strong>Available</strong> tab, and install. </p></li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.36.05-pm.png" alt="Manage Plugins" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Manage Plugins</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.36.50-pm.png" alt="Deploy to container plugin" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Deploy to container plugin</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.38.23-pm.png" alt="Maven Integration plugin" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Maven Integration plugin</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ol start="2">
<li><strong>Configure Java and Maven on Jenkins</strong><br><br />
While building and deploying the application, the right compatible version of Java Maven should be present on the Jenkins server. You can check the version of Java and Maven from inside of the Jenkins container:</li>
</ol>
<pre><code class="bash language-bash"># Open a shell into the Jenkins container
docker exec -it myContainer bash
java -version
echo $JAVA_HOME
# We already installed Maven using the command "apk add maven" earlier
mvn -version</code></pre>
<p>Go to the Jenkins console, and open the Manage Jenkins &#8594; Global Tool Configuration settings. </p>
<p><center></p>
<table>
<thead>
<tr>
<th id="**section**"><strong>Section</strong></th>
<th id="**field**"><strong>Field</strong></th>
<th id="**value**"><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>JDK</td>
<td>JDK Name</td>
<td><code>JDK1.8</code></td>
</tr>
<tr>
<td></td>
<td>JAVA_HOME</td>
<td>The output of <code>echo $JAVA_HOME</code>, <br>such as <code>/opt/java/openjdk</code></td>
</tr>
<tr>
<td>Maven</td>
<td>Maven Name</td>
<td>Check the version using <code>mvn -version</code> <br>in your container, such as Maven 3.6.3</td>
</tr>
<tr>
<td></td>
<td>Install automatically</td>
<td>Check</td>
</tr>
</tbody>
</table>
<h2 id="center"></center></h2>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.40.40-pm.png" alt="JDK section in Global Tool Configuration" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>JDK section in Global Tool Configuration</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.48.33-pm.png" alt="Check Java and Maven version in Jenkins container" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Check Java and Maven version in Jenkins container</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-5.39.50-pm.png" alt="Maven section in Global Tool Configuration" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Maven section in Global Tool Configuration</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>ND035 C4 Security And DevOps Deploy 01d</p></h3>
  <video controls>
  <source src="15. ND035 C4 Security And DevOps Deploy 01d-SEP7LZRWN3M.mp4" type="video/mp4">

</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ol start="3">
<li><strong>Configure the Job</strong><br><br />
If you already have a <strong>Job</strong> created from the earlier demo, go ahead and configure it again. Else, create a new <strong>Freestyle project</strong> type job, say <em>myFirstJob</em>. (Feel free to check the Pipeline project type, next time). </li>
</ol>
<ul>
<li>Use the following configuration details, and leave the remaining as default:</li>
</ul>
<p><center></p>
<table>
<thead>
<tr>
<th id="**section**"><strong>Section</strong></th>
<th id="**field**"><strong>Field</strong></th>
<th id="**value**"><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>General</td>
<td>Description</td>
<td>Text of your choice</td>
</tr>
<tr>
<td></td>
<td>Github project</td>
<td>Provide your Github repository URL</td>
</tr>
<tr>
<td>Source Code Management</td>
<td>Git</td>
<td>Check</td>
</tr>
<tr>
<td></td>
<td>Repository URL</td>
<td>Provide your Github repository URL</td>
</tr>
<tr>
<td></td>
<td>Credentials</td>
<td>Choose the one you've created in the Global credentials</td>
</tr>
<tr>
<td>Build Triggers</td>
<td>Poll SCM &#8594; Schedule</td>
<td><code>* * * * *</code><br> It means poll the code every minute. <br> Youcan also use <code>H * * * *</code> to poll once per hour</td>
</tr>
<tr>
<td>Build Environment</td>
<td>Delete workspace before build starts</td>
<td>Check<br>Jenkins creates a workspace where it stores <br> the build file, such as WAR. In our case, this workspace <br> will be available in the Jenkins container</td>
</tr>
<tr>
<td>Build</td>
<td>Add build step</td>
<td>Invoke top-level Maven targets</td>
</tr>
<tr>
<td></td>
<td>Goals</td>
<td><code>clean compile package</code> <br> <em>clean</em> - delete the existing target folder<br><em>compile</em> - compile source code<br><em>package</em> - package the application to WAR file. <br>Note that the package type in POM.xml is WAR</td>
</tr>
<tr>
<td></td>
<td>POM</td>
<td>Specify the POM file path relative to your repository home, <br>such as  <code>starter_code/pom.xml</code></td>
</tr>
</tbody>
</table>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ul>
<li>Above configuration might seem familiar to you. The section responsible for deployment to the target container is <strong>Post-build Actions</strong>. In this section, choose the <strong>Deploy war/ear to a container</strong> option, and use the following configuration details:</li>
</ul>
<p><center></p>
<table>
<thead>
<tr>
<th id="**field**"><strong>Field</strong></th>
<th id="**value**"><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>WAR/EAR files</td>
<td><code>**/*.war</code></td>
</tr>
<tr>
<td>Context path</td>
<td><code>myApp</code><br>Context represents a single web application running within a given instance of Tomcat.</td>
</tr>
<tr>
<td>Containers</td>
<td>Choose Tomcat 9 <br><em>(Because our Tomcat container is having v9)</em></td>
</tr>
<tr>
<td>Credentials</td>
<td>Add a new credentials<br> Add Global credentials with username/password as admin/admin .<br> Recall that we created these credentials in the Tomcat container, <code>tomcat-users.xml</code> file</td>
</tr>
<tr>
<td>Tomcat URL</td>
<td><<strong>Private IP</strong> of <strong>host</strong> EC2 instance>:8888<br>Recall that we had mapped 8888 port of host with the 8080 port of Tomcat container</td>
</tr>
<tr>
<td></center></td>
<td></td>
</tr>
<tr>
<td>&nbsp; &nbsp; &nbsp; &nbsp; The reason we are using the <strong>Private IP</strong> of <strong>host</strong> EC2 instance is because the public one keeps changing with time.</td>
<td></td>
</tr>
</tbody>
</table>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-9.14.05-pm.png" alt="Post-build Actions &amp;#8594; Deploy war/ear to a container settings" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Post-build Actions &#8594; Deploy war/ear to a container settings</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ol start="4">
<li><strong>Build and Verify</strong><br></li>
</ol>
<ul>
<li>Save the job, and click on the "Build Now" option.</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-9.21.54-pm.png" alt="Successful deployment" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Successful deployment</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-9.45.00-pm.png" alt="Jenkins dashboard showing the SUCCESS status of the *myFirstJob*" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>Jenkins dashboard showing the SUCCESS status of the <em>myFirstJob</em></p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ul>
<li>Verify the deployment in the running Tomcat container. If you are logged out of the SSH connection, then reconnect to the host EC2 instance. Open a shell into the Tomcat container, and check the contents of the <strong>webapps</strong> folder. You must notice the newly created <strong>myApp</strong> folder there.</li>
</ul>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/screenshot-2021-02-12-at-9.35.32-pm.png" alt="The deployed WAR file and the correponding extracted folder" class="img img-fluid">
    <figcaption class="figure-caption">
      <p>The deployed WAR file and the correponding extracted folder</p>
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <ul>
<li>The Jenkins deployed the WAR file, and the Tomcat server automatically extracts it to a folder. </li>
</ul>
<p><br><br />
<strong>Congratulations! You have finished your first pipeline deployment on the cloud.</strong></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <hr />
<h3 id="optional-step">Optional Step</h3>
<h4 id="verify-if-tomcat-can-automatically-extract-the-war-file-present-inside-the-webapps-folder">Verify if Tomcat can automatically extract the WAR file present inside the <em>webapps</em> folder</h4>
<p>Let's copy a <a href="https://tomcat.apache.org/tomcat-7.0-doc/appdev/sample/" rel="noopener noreferrer" target="_blank">Sample Application</a> </p>
<ol>
<li><p>Download the <strong>sample.war</strong> file from the link above. We have also attached the same file at the bottom of this page.</p></li>
<li><p>Copy the <strong>sample.war</strong> file from the local computer to the host EC2 instance:</p></li>
</ol>
<pre><code>scp -i AWS_EC2_DemoKey.pem ../Desktop/sample.war ec2-user@3.141.40.172:/home/ec2-user/sample.war</code></pre>
<p>In the command above:</p>
<ul>
<li>The key file is present inside the current folder.</li>
<li>The sample.war file is downloaded from the link mentioned above, and present in the<code>../Desktop/</code> folder. </li>
<li>The <code>3.141.40.172</code> is the public IP address of the EC2 instance</li>
<li>The target folder is <code>home/ec2-user/</code><br />
You can tweak the command above as applicable to you. </li>
</ul>
<ol>
<li>Once the <strong>sample.war</strong> file is transferred to the host EC2 instance, copy the same file to the container. </li>
</ol>
<pre><code># The sample.war file must be present in the home directory of the logged-in user
ls
# Copy the file to the "myTomcatServer" container
docker cp sample.war myTomcatServer:/usr/local/tomcat/webapps/</code></pre>
<ol start="4">
<li>Tomcat will automatically extract the sample.war file present inside the <em>webapps</em> folder. You can check the output at <a href="http://18.222.193.10:8888/sample" rel="noopener noreferrer" target="_blank">http://18.222.193.10:8888/sample</a> URL. </li>
</ol>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <blockquote>
  <p>To download the supporting material below, right-click on the file name and select the "<em>Save Link As…</em>"  (Chrome or Firefox) / "<em>Download Linked File As…</em>"  (Safari) / "<em>Save As…</em>" (Windows Edge) option.  </p>
</blockquote>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="16. Another Deployment.html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('15. Deployment - III')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
